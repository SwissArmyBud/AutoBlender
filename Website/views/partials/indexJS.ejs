
<script src="/socket.io/socket.io.js"></script>

<script>
var socket = io();
socket.on('connect', function(){console.log("Connected to socketIO!");});

socket.on("uploadStatus", function(data){
  switch(data.status){
    // UPLOAD DONE
    case("::UPD"):{
      console.log("Incoming status update:");
      console.log(data);
      break;
    }
    // SOCKET ID PROVIDED
    case("::SID"):{
      console.log("Incoming status update:");
      console.log(data);
      break;
    }
    // SOCKET ID PROVIDED
    case("::PY3"):{
      console.log(data.stdout);
      break;
    }
  }
});
//socket.on('event', function(data){});
//socket.on('disconnect', function(){});

$(function(){
  console.log("JQuery loaded!");
  $("#fileInput").on('change', (event)=>{
    console.log("Change in file!");
    $("#uploadButton").css("visibility", "visible");

    $("#uploadButton").click(function(event){
      event.preventDefault();
      console.log("Upload button clicked!");
      $("#socketID").val(socket.id);
      console.log($("#uploadForm"));
      console.log("Submitting form!");
      var formData = new FormData($("#uploadForm")[0]);
      $("#fileUploadProgress").css("visibility", "visible");
      $("#fileUploadProgress").append($("<div/>").attr("id", "progressText"));
      $.ajax({
        xhr: function()
        {
          var xhr = new window.XMLHttpRequest();
          //Upload progress
          xhr.upload.addEventListener("progress", function(evt){
            if (evt.lengthComputable) {
              var percentComplete = 100 * (evt.loaded / evt.total);
              $("#progressText").text(percentComplete);
              //Do something with upload progress
              console.log(percentComplete);
            }
          }, false);
          return xhr;
        },
        url: "/upload",
        type: 'POST',
        data: formData,
        success: function (data) {
          console.log("Finished upload!");
          console.log(data);
          $("#fileProcessingProgress").css("visibility", "visible");
          $("#fileProcessingProgress").text("Processing...");
        },
        cache: false,
        contentType: false,
        processData: false
      }); // ajax process
    }); // upload button click

  }); // on file input change

}); // jQuery ready
</script>
