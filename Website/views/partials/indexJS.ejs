
<script src="/socket.io/socket.io.js"></script>

<script>
var socket = io();
socket.on('connect', function(){console.log("Connected to socketIO!");});
socket.on("uploadStatus", function(data){console.log(data);});
//socket.on('event', function(data){});
//socket.on('disconnect', function(){});

var file;

$(function(){
  console.log("JQuery loaded!");
  $("#fileInput").on('change', (event)=>{
    console.log("Change in file!");
    file = event.target.files[0];
    console.log(file);
    $("#uploadButton").css("visibility", "visible");

    $("#uploadButton").click(function(event){
      event.preventDefault();
      console.log("Upload button clicked!");
      $("#socketID").val(socket.id);
      console.log($("#uploadForm"));
      $("#uploadForm").submit(function(e) {
        e.preventDefault();
        console.log("Submitting form!");
        var formData = new FormData(this);
        $.ajax({
          xhr: function()
          {
            var xhr = new window.XMLHttpRequest();
            //Upload progress
            xhr.upload.addEventListener("progress", function(evt){
              if (evt.lengthComputable) {
                var percentComplete = evt.loaded / evt.total;
                //Do something with upload progress
                console.log(percentComplete);
              }
            }, false);
            return xhr;
          },
          url: "/upload",
          type: 'POST',
          data: formData,
          success: function (data) {
            console.log("Finished upload!");
            console.log(data);
          },
          cache: false,
          contentType: false,
          processData: false
        }); // ajax process
      }); // form submit
    }); // upload button click

  }); // on file input change

}); // jQuery ready
</script>
